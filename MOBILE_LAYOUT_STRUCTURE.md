# Структура мобильного интерфейса

## Иерархия слоев (z-index)

```
┌─────────────────────────────────────────────────────────┐
│  Input Dialogs (z-index: 10002)                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │  Диалоги ввода имени/пароля                       │  │
│  │  - Позиция: 20vh от верха                         │  │
│  │  - max-height: 60vh                               │  │
│  │  - Над клавиатурой                                │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Fullscreen Modals (z-index: 10001)                     │
│  ┌───────────────────────────────────────────────────┐  │
│  │  "О программе" / "Совместное рисование"          │  │
│  │  - Полный экран (100vh/100dvh)                   │  │
│  │  - Без ограничений по высоте                     │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Regular Modals (z-index: 10000)                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Toolbar Submenu (z-index: 1002)                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Toolbar (z-index: 1001)                                │
│  50px высота + safe-area-inset-top                      │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  TopMenu (z-index: 1000)                                │
│  50px высота + safe-area-inset-top                      │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  SettingBar (z-index: 1000)                             │
│  Позиция: 100px + safe-area-inset-top                   │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  "О программе" Button (z-index: 999)                    │
│  Только в локальном режиме                              │
│  Позиция: fixed bottom                                  │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  Canvas (z-index: 1)                                    │
│  Позиция: 100px + safe-area-inset-top от верха          │
│  - Скроллируемый при увеличении                         │
│  - Стилизованные скроллбары                             │
└─────────────────────────────────────────────────────────┘
```

## Вертикальная структура экрана

### Локальный режим (без чата)

```
┌─────────────────────────────────────────┐ ← 0px
│  safe-area-inset-top                    │
├─────────────────────────────────────────┤
│  TopMenu (50px)                         │ ← 0px + safe-area
├─────────────────────────────────────────┤
│  Toolbar (50px)                         │ ← 50px + safe-area
├─────────────────────────────────────────┤
│  SettingBar (50px, если открыт)         │ ← 100px + safe-area
├─────────────────────────────────────────┤
│                                         │
│  Canvas (flex: 1)                       │ ← 100px + safe-area
│  - Центрирован по вертикали             │
│  - padding-bottom: 60px                 │
│  - overflow: auto (при увеличении)      │
│                                         │
├─────────────────────────────────────────┤
│  Кнопка "О программе" (fixed)           │ ← bottom: 10px
│  + safe-area-inset-bottom               │
└─────────────────────────────────────────┘
```

### Режим совместного рисования (с чатом)

```
┌─────────────────────────────────────────┐ ← 0px
│  safe-area-inset-top                    │
├─────────────────────────────────────────┤
│  TopMenu (50px)                         │
├─────────────────────────────────────────┤
│  Toolbar (50px)                         │
├─────────────────────────────────────────┤
│  SettingBar (50px, если открыт)         │
├─────────────────────────────────────────┤
│                                         │
│  Canvas (flex: 1)                       │
│  - Выровнен по верху                    │
│  - overflow: auto (при увеличении)      │
│                                         │
├─────────────────────────────────────────┤
│  Chat (max-height: 250px)               │
│  + safe-area-inset-bottom               │
└─────────────────────────────────────────┘
```

## Модальные окна

### Fullscreen Modal ("О программе", "Совместное рисование")

```
┌─────────────────────────────────────────┐
│  Overlay (100vh/100dvh)                 │
│  ┌───────────────────────────────────┐  │
│  │ safe-area-inset-top               │  │
│  ├───────────────────────────────────┤  │
│  │ Кнопка закрытия (×)               │  │
│  ├───────────────────────────────────┤  │
│  │                                   │  │
│  │ Контент (100% высоты)             │  │
│  │ - overflow-y: auto                │  │
│  │                                   │  │
│  ├───────────────────────────────────┤  │
│  │ safe-area-inset-bottom            │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### Input Dialog (Ввод имени/пароля)

```
┌─────────────────────────────────────────┐
│  Overlay (100vh/100dvh)                 │
│  ┌───────────────────────────────────┐  │
│  │ padding-top: 20vh + safe-area     │  │
│  ├───────────────────────────────────┤  │
│  │                                   │  │
│  │ Dialog (max-height: 60vh)         │  │ ← Над клавиатурой
│  │ - Кнопка закрытия                 │  │
│  │ - Заголовок                       │  │
│  │ - Поле ввода (autofocus)          │  │
│  │ - Кнопка действия                 │  │
│  │                                   │  │
│  ├───────────────────────────────────┤  │
│  │ padding-bottom: 20vh + safe-area  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

## Скроллбары при увеличении холста

```
Canvas Container (overflow: auto)
┌─────────────────────────────────────────┐
│  ┌─────────────────────────────────┐ ▲  │
│  │                                 │ █  │ ← Вертикальный скроллбар
│  │  Увеличенный холст              │ █  │   (12px, золотой цвет)
│  │  (больше viewport)              │ █  │
│  │                                 │ ▼  │
│  └─────────────────────────────────┘    │
│  ◄█████████████████████████████████►    │ ← Горизонтальный скроллбар
└─────────────────────────────────────────┘   (12px, золотой цвет)
```

## Safe Area Inset

Поддержка для устройств с "челкой" (iPhone X+):

```
┌─────────────────────────────────────────┐
│ ▓▓▓▓▓▓▓▓▓▓ ЧЕЛКА ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  │ ← safe-area-inset-top
├─────────────────────────────────────────┤
│  TopMenu (учитывает safe-area)          │
│  Toolbar (учитывает safe-area)          │
│  Canvas (учитывает safe-area)           │
│                                         │
│  Контент                                │
│                                         │
├─────────────────────────────────────────┤
│  Кнопка (учитывает safe-area)           │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  │ ← safe-area-inset-bottom
└─────────────────────────────────────────┘
```

## Ключевые особенности

### 1. Позиционирование
- TopMenu: `top: 0` + safe-area
- Toolbar: `top: 50px` + safe-area
- SettingBar: `top: 100px` + safe-area
- Canvas: `top: 100px` + safe-area (было 160px ❌)

### 2. Z-Index иерархия
- Canvas: 1 (самый низкий)
- Меню: 1000-1001
- Кнопки: 999
- Модалки: 10000-10002 (самый высокий)

### 3. Overflow
- Canvas container: `overflow: auto` ✅
- Wrapper: `min-width/height: min-content` ✅
- Скроллбары: стилизованные, 12px, золотые ✅

### 4. Модальные окна
- Fullscreen: 100vh/100dvh, без ограничений ✅
- Input dialogs: 20vh от верха, max-height 60vh ✅
- Все с z-index > 10000 ✅

### 5. Кнопка "О программе"
- Только в локальном режиме ✅
- Fixed bottom ✅
- z-index: 999 ✅
- С учетом safe-area-inset-bottom ✅
