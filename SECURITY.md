# Безопасность

## Реализованные меры безопасности

### 1. ✅ Хеширование паролей (bcrypt)
- Пароли комнат хранятся в виде bcrypt-хешей с 10 раундами
- Невозможно восстановить оригинальный пароль из хеша
- Защита от rainbow table атак

### 2. ✅ Улучшенная XSS защита
- Использование библиотеки `validator` для экранирования HTML
- Удаление опасных паттернов: `javascript:`, `on*=`, `<script>`
- Санитизация всех пользовательских входных данных
- Content Security Policy (CSP) через helmet

### 3. ✅ Rate Limiting
- **API endpoints**: 100 запросов за 15 минут на IP
- **Создание комнат**: 10 комнат в час на IP
- **Проверка паролей**: 20 попыток за 15 минут на IP
- **WebSocket сообщения**: 50 сообщений в секунду на соединение

### 4. ✅ CSRF защита
- Строгая CORS политика с белым списком доменов
- Ограничение методов HTTP: только GET и POST
- Контроль заголовков: только Content-Type

### 5. ✅ Helmet Security Headers
- Content Security Policy (CSP)
- X-Frame-Options
- X-Content-Type-Options
- Strict-Transport-Security
- X-DNS-Prefetch-Control

### 6. ✅ Ужесточенная CORS политика
- Разрешены только:
  - `https://risovanie.online`
  - `http://localhost:3000` (для разработки)
  - `*.onrender.com` (только в production для деплоя)
- Удалён широкий доступ для всех поддоменов

### 7. ✅ Удалены устаревшие домены
- Убраны все упоминания `paint-art.ru`
- Обновлены тесты и документация

## Дополнительные меры безопасности

### Валидация входных данных
- Ограничение длины имён комнат: 100 символов
- Ограничение длины имён пользователей: 50 символов
- Ограничение длины сообщений: 500 символов
- Ограничение размера JSON: 5MB

### Таймауты и очистка
- Автоматическое отключение неактивных пользователей: 10 минут
- Автоматическое удаление старых комнат: 3 дня
- Периодическая очистка данных: каждый час

### WebSocket безопасность
- Валидация всех входящих сообщений
- Автоматическое закрытие соединений при превышении лимитов
- Очистка rate limit данных при закрытии соединения

## Рекомендации для продакшена

1. **Переменные окружения**
   ```bash
   NODE_ENV=production
   PORT=5000
   ```

2. **HTTPS**
   - Всегда используйте HTTPS в продакшене
   - Настройте автоматический редирект с HTTP на HTTPS

3. **Мониторинг**
   - Отслеживайте подозрительную активность
   - Логируйте попытки превышения rate limits
   - Мониторьте использование ресурсов

4. **Регулярные обновления**
   ```bash
   npm audit
   npm audit fix
   ```

5. **Бэкапы**
   - Регулярное резервное копирование `roomInfo.json`
   - Резервное копирование папки `room_data/`

## Отчёт об уязвимостях

Если вы обнаружили уязвимость безопасности, пожалуйста, свяжитесь с нами напрямую, а не создавайте публичный issue.

## История изменений

### 2026-02-01
- ✅ Добавлено хеширование паролей (bcrypt)
- ✅ Улучшена XSS защита (validator)
- ✅ Добавлен rate limiting (express-rate-limit)
- ✅ Добавлены security headers (helmet)
- ✅ Ужесточена CORS политика
- ✅ Удалены упоминания paint-art.ru
